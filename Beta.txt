This code is written by Parthy.
New code added by Ram.